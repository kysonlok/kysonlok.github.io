<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="google-site-verification" content="BEJwibIBrcAQPUa_NmC_S46RiD5z0xyL0WpGrZEEv34"><title>分类: 脚本语言 - Kyson.Lok</title><meta property="og:type" content="blog"><meta property="og:title" content="Kyson.Lok"><meta property="og:url" content="http://kysonlok.github.io/"><meta property="og:site_name" content="Kyson.Lok"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://kysonlok.github.io/img/og_image.png"><meta property="article:author" content="Kyson Lok"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://kysonlok.github.io"},"headline":"Kyson.Lok","image":["http://kysonlok.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Kyson Lok"},"description":""}</script><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Kyson&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/kysonlok"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li class="is-active"><a href="#" aria-current="page">脚本语言</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-06-12T14:55:11.000Z" title="2020-06-12T14:55:11.000Z">2020-06-12</time><span class="level-item"><a class="link-muted" href="/categories/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80/">脚本语言</a></span><span class="level-item">14 分钟 读完 (大约 2081 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/06/12/Linux-awk-%E5%91%BD%E4%BB%A4%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">Linux awk 命令入门教程</a></h1><div class="content"><h2 id="printf-格式化输出"><a href="#printf-格式化输出" class="headerlink" title="printf 格式化输出"></a>printf 格式化输出</h2><p>awk 的格式化输出，和 C 语言的 printf 没什么区别。让我们来看一下以下的格式化输出示例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">输入：echo 123.4567 | awk &#39;&#123;printf &quot;%.3f\n&quot;, $1&#125;&#39;</span><br><span class="line">输出：123.457</span><br><span class="line"></span><br><span class="line"># 不满8字符向左填充空格，并且只保留一位小数</span><br><span class="line">输入：echo 123.4567 | awk &#39;&#123;printf &quot;%8.1f\n&quot;, $1&#125;&#39;</span><br><span class="line">输出：   123.5</span><br><span class="line"></span><br><span class="line"># 第一个元素不满20字符向右填充空格，并且保留七位小数；第二个元素以整形输出</span><br><span class="line">输入：echo 123.4567 55.2 | awk &#39;&#123;printf &quot;%-20.7f  %d\n&quot; , $1 , $2&#125;&#39;</span><br><span class="line">输出：123.4567000           55</span><br></pre></td></tr></table></figure>

<p>格式控制的字符列表说明如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#96;c&#39;    This prints a number as an ASCII character. Thus, &#96;printf &quot;%c&quot;, 65&#39; outputs the letter &#96;A&#39;. </span><br><span class="line">          The output for a string value is the first character of the string. </span><br><span class="line"></span><br><span class="line">&#96;d&#39;    This prints a decimal integer. </span><br><span class="line"></span><br><span class="line">&#96;i&#39;    This also prints a decimal integer. </span><br><span class="line"></span><br><span class="line">&#96;e&#39;    This prints a number in scientific (exponential) notation. </span><br><span class="line">           For example, printf &quot;%4.3e&quot;, 1950  prints &#96;1.950e+03&#39;, </span><br><span class="line">           with a total of four significant figures of which three follow the decimal point. </span><br><span class="line">           The &#96;4.3&#39; are modifiers, discussed below. </span><br><span class="line"></span><br><span class="line">&#96;f&#39;    This prints a number in floating point notation. </span><br><span class="line"></span><br><span class="line">&#96;g&#39;    This prints a number in either scientific notation or floating point notation, whichever uses fewer characters. </span><br><span class="line"></span><br><span class="line">&#96;o&#39;    This prints an unsigned octal integer. </span><br><span class="line"></span><br><span class="line">&#96;s&#39;    This prints a string. </span><br><span class="line"></span><br><span class="line">&#96;x&#39;    This prints an unsigned hexadecimal integer. </span><br><span class="line"></span><br><span class="line">&#96;X&#39;    This prints an unsigned hexadecimal integer. </span><br><span class="line">          However, for the values 10 through 15, it uses the letters &#96;A&#39; through &#96;F&#39; instead of &#96;a&#39; through &#96;f&#39;. </span><br><span class="line"></span><br><span class="line">&#96;%&#39;    This isn&#39;t really a format-control letter, but it does have a meaning when used after a &#96;%&#39;: the sequence &#96;%%&#39; outputs one &#96;%&#39;. </span><br><span class="line">         It does not consume an argument.</span><br></pre></td></tr></table></figure>

<h2 id="BEGIN-END"><a href="#BEGIN-END" class="headerlink" title="BEGIN/END"></a>BEGIN/END</h2><p>在读取第一个输入记录之前，BEGIN 规则仅执行一次。同样，在读取所有输入之后，END 规则仅执行一次。例如： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># awk -F&quot;:&quot; &#39;BEGIN&#123;print &quot;Show all users:&quot;&#125; &#123;print $1&#125; END&#123;print &quot;&#x3D;&#x3D;&#x3D;&#x3D;&gt; Successful!&quot;&#125;&#39; &#x2F;etc&#x2F;passwd</span><br><span class="line">Show all users:</span><br><span class="line">root</span><br><span class="line">daemon</span><br><span class="line">ftp</span><br><span class="line">network</span><br><span class="line">nobody</span><br><span class="line">dnsmasq</span><br><span class="line">stubby</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&gt; Successful!</span><br></pre></td></tr></table></figure>

<h2 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h2><h3 id="FS-变量"><a href="#FS-变量" class="headerlink" title="FS 变量"></a>FS 变量</h3><p>FS 变量用于指定输入字段的分隔符。  </p>
<p>awk 默认以空白字符（空格或 tab）来解析从输入读取的每一行，并设置变量 $1，$2 等，FS 变量用于设置字段分隔符，它可以设置为任何单个字符或正则表达式。我们可以通过以下两种方式来使用 FS 变量：  </p>
<ol>
<li>命令行使用 -F 选项；  </li>
<li>直接设置 FS 变量；  </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Syntax:</span><br><span class="line"></span><br><span class="line">awk -F&#39;FS&#39; &#39;commands&#39; inputfilename</span><br><span class="line"></span><br><span class="line">(or)</span><br><span class="line"></span><br><span class="line">awk &#39;BEGIN&#123;FS&#x3D;&quot;FS&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>这是一个 awk FS 示例，以 “:” 作为分隔符处理 <code>/etc/passwd</code> 文件。为了易读，这里使用了 awk 脚本的形式。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cat passwd.awk</span><br><span class="line"># 处理前</span><br><span class="line">BEGIN&#123;</span><br><span class="line">	FS&#x3D;&quot;:&quot;;</span><br><span class="line">	print &quot;Name\tUserID\tGroupID\tHomeDirectory&quot;;</span><br><span class="line">&#125;</span><br><span class="line"># 处理中</span><br><span class="line">&#123;</span><br><span class="line">	print $1&quot;\t&quot;$3&quot;\t&quot;$4&quot;\t&quot;$6;</span><br><span class="line">&#125;</span><br><span class="line"># 处理后</span><br><span class="line">END &#123;</span><br><span class="line">	print NR,&quot;Records Processed&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># awk -f passwd.awk &#x2F;etc&#x2F;passwd</span><br><span class="line">Name	UserID	GroupID	Home</span><br><span class="line">root	0	0	&#x2F;root</span><br><span class="line">daemon	1	1	&#x2F;var</span><br><span class="line">ftp	55	55	&#x2F;home&#x2F;ftp</span><br><span class="line">network	101	101	&#x2F;var</span><br><span class="line">nobody	65534	65534	&#x2F;var</span><br><span class="line">dnsmasq	453	453	&#x2F;var&#x2F;run&#x2F;dnsmasq</span><br><span class="line">stubby	410	410	&#x2F;var&#x2F;run&#x2F;stubby</span><br><span class="line">7 Records Processed</span><br></pre></td></tr></table></figure>

<h3 id="OFS-变量"><a href="#OFS-变量" class="headerlink" title="OFS 变量"></a>OFS 变量</h3><p>OFS 变量用于指定输出字段的分隔符。    </p>
<p>OFS 是 FS 变量的输出等价物，默认值是空格。下面是使用 OFS 缺省值的示例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># awk -F&#39;:&#39; &#39;&#123;print $3,$4;&#125;&#39; &#x2F;etc&#x2F;passwd</span><br><span class="line">0 0</span><br><span class="line">1 1</span><br><span class="line">55 55</span><br><span class="line">101 101</span><br><span class="line">65534 65534</span><br><span class="line">453 453</span><br><span class="line">410 410</span><br></pre></td></tr></table></figure>

<p>print 语句中的 “,” 表示两个参数使用空格连接起来，也就是 OFS 的默认值。OFS 的值将被插入到输出字段间，示例如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># awk -F&#39;:&#39; &#39;BEGIN&#123;OFS&#x3D;&quot;&#x3D;&quot;;&#125; &#123;print $3,$4;&#125;&#39; &#x2F;etc&#x2F;passwd</span><br><span class="line">0&#x3D;0</span><br><span class="line">1&#x3D;1</span><br><span class="line">55&#x3D;55</span><br><span class="line">101&#x3D;101</span><br><span class="line">65534&#x3D;65534</span><br><span class="line">453&#x3D;453</span><br><span class="line">410&#x3D;410</span><br></pre></td></tr></table></figure>

<h3 id="RS-变量"><a href="#RS-变量" class="headerlink" title="RS 变量"></a>RS 变量</h3><p>RS 变量用于指定输入字段的记录分隔符。    </p>
<p>RS 定义了行，awk 缺省情况是以换行符为分隔符一行一行读取的，设置 RS 变量可以让 awk 按照 RS 的分隔符读取。  </p>
<p>让我们把软件包信息存到一个文件，每个软件信息以一个空行作为分割，每个字段以换行符分隔。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># cat opkg.info </span><br><span class="line">Package: iwinfo</span><br><span class="line">Version: 2018-07-24-94b1366d-2</span><br><span class="line">Depends: libc, libiwinfo</span><br><span class="line">Status: install user installed</span><br><span class="line">Architecture: mips_24kc</span><br><span class="line">Installed-Time: 1553831708</span><br><span class="line"> </span><br><span class="line">Package: luci-mod-rpc</span><br><span class="line">Version: git-18.196.56128-9112198-1</span><br><span class="line">Depends: libc, luci-lib-json</span><br><span class="line">Status: install user installed</span><br><span class="line">Architecture: all</span><br><span class="line">Installed-Time: 1553831708</span><br><span class="line"></span><br><span class="line">Package: ubus                 </span><br><span class="line">Version: 2018-01-16-5bae22eb-1</span><br><span class="line">Depends: libc, libubus, libblobmsg-json, ubusd</span><br><span class="line">Status: install ok installed</span><br><span class="line">Architecture: mips_24kc</span><br><span class="line">Installed-Time: 1553831711</span><br><span class="line">Auto-Installed: yes</span><br></pre></td></tr></table></figure>

<p>以下是使用 RS 变量打印软件包名称的示例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># cat opkg.awk </span><br><span class="line">BEGIN &#123;</span><br><span class="line">	RS&#x3D;&quot;&quot;;</span><br><span class="line">	FS&#x3D;&quot; &quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">	print $2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># awk -f opkg.awk opkg.info </span><br><span class="line">iwinfo</span><br><span class="line">luci-mod-rpc</span><br><span class="line">ubus</span><br></pre></td></tr></table></figure>

<p>在 opkg.awk 脚本中，RS 被赋值为空，它将匹配到空行，因此把每个软件包详细信息作为单个记录读取，并且记录中的每一行都是一个字段，而分隔字段使用 FS 变量，为了提取软件包名称，这里使用了空格（” “)作为 FS 的分隔符。  </p>
<h3 id="ORS-变量"><a href="#ORS-变量" class="headerlink" title="ORS 变量"></a>ORS 变量</h3><p>ORS 变量用于指定输出字段的记录分隔符。  </p>
<p>ORS 是 RS 变量的输出等价物，表示输出中的每条记录都将用这个分隔符打印。下面是使用 ORS 的示例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># awk &#39;BEGIN&#123;ORS&#x3D;&quot;&#x3D;&gt;&quot;; RS&#x3D;&quot;&quot;&#125; &#123;print;&#125;&#39; opkg.info </span><br><span class="line">Package: iwinfo</span><br><span class="line">Version: 2018-07-24-94b1366d-2</span><br><span class="line">Depends: libc, libiwinfo</span><br><span class="line">Status: install user installed</span><br><span class="line">Architecture: mips_24kc</span><br><span class="line">Installed-Time: 1553831708</span><br><span class="line"> &#x3D;&gt;Package: luci-mod-rpc</span><br><span class="line">Version: git-18.196.56128-9112198-1</span><br><span class="line">Depends: libc, luci-lib-json</span><br><span class="line">Status: install user installed</span><br><span class="line">Architecture: all</span><br><span class="line">Installed-Time: 1553831708&#x3D;&gt;Package: ubus                 </span><br><span class="line">Version: 2018-01-16-5bae22eb-1</span><br><span class="line">Depends: libc, libubus, libblobmsg-json, ubusd</span><br><span class="line">Status: install ok installed</span><br><span class="line">Architecture: mips_24kc</span><br><span class="line">Installed-Time: 1553831711</span><br><span class="line">Auto-Installed: yes&#x3D;&gt;</span><br></pre></td></tr></table></figure>

<p>上面的 awk 表达式中，以每个软件包信息作为一条记录，并且记录的输出用”=&gt;”分隔。  </p>
<h3 id="NR-变量"><a href="#NR-变量" class="headerlink" title="NR 变量"></a>NR 变量</h3><p>NR 变量表示当前的记录数。   </p>
<blockquote>
<p>注意，不一定等于行数，如果设置了 RS 或 ORS，不再是按行读取，而是按 RS 或 ORS 分隔符读取，可以是单行，也可以是多行。  </p>
</blockquote>
<p>NR 表示已经读出的记录数或者行号，从 1 开始，如果有多个文件话，这个值也是不断累加中。  </p>
<p>在下面的 NR 示例中，NR 变量记录当前的记录数，等同于行号，在 END 部分中，NR 告诉我们文件中的记录总数。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># awk &#39;&#123;print &quot;Processing Record - &quot;,NR;&#125;END &#123;print NR, &quot;Packages Records are processed&quot;;&#125;&#39; opkg.info </span><br><span class="line">Processing Record -  1</span><br><span class="line">Processing Record -  2</span><br><span class="line">Processing Record -  3</span><br><span class="line">Processing Record -  4</span><br><span class="line">Processing Record -  5</span><br><span class="line">Processing Record -  6</span><br><span class="line">Processing Record -  7</span><br><span class="line">Processing Record -  8</span><br><span class="line">Processing Record -  9</span><br><span class="line">Processing Record -  10</span><br><span class="line">Processing Record -  11</span><br><span class="line">Processing Record -  12</span><br><span class="line">Processing Record -  13</span><br><span class="line">Processing Record -  14</span><br><span class="line">Processing Record -  15</span><br><span class="line">Processing Record -  16</span><br><span class="line">Processing Record -  17</span><br><span class="line">Processing Record -  18</span><br><span class="line">Processing Record -  19</span><br><span class="line">Processing Record -  20</span><br><span class="line">Processing Record -  21</span><br><span class="line">Processing Record -  22</span><br><span class="line">Processing Record -  23</span><br><span class="line">Processing Record -  24</span><br><span class="line">Processing Record -  25</span><br><span class="line">25 Packages Records are processed</span><br></pre></td></tr></table></figure>

<h3 id="NF-变量"><a href="#NF-变量" class="headerlink" title="NF 变量"></a>NF 变量</h3><p>NF 变量表示当前记录的字段总数，也就是列数。NF 对于验证记录中是否存在所有字段非常有用。  </p>
<p>让我们来看一个学生成绩文件，其中有学生缺少一项成绩，如下所示。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat student.txt </span><br><span class="line">Jones 78 84 77</span><br><span class="line">Gondrol 56 58 45</span><br><span class="line">RinRao 38 37</span><br><span class="line">Edwin 78 67 45</span><br><span class="line">Dayan 30 47</span><br></pre></td></tr></table></figure>

<p>以下的 awk 脚本，打印记录(行)号和该记录中的字段数，很容易发现哪些学生的成绩缺少了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># awk &#39;&#123;print NR,&quot;-&gt;&quot;,NF&#125;&#39; student.txt </span><br><span class="line">1 -&gt; 4</span><br><span class="line">2 -&gt; 4</span><br><span class="line">3 -&gt; 3</span><br><span class="line">4 -&gt; 4</span><br><span class="line">5 -&gt; 3</span><br></pre></td></tr></table></figure>

<h3 id="FILENAME-变量"><a href="#FILENAME-变量" class="headerlink" title="FILENAME 变量"></a>FILENAME 变量</h3><p>FILENAME 变量表示当前输入的文件名。  </p>
<p>以下的示例，在处理完后把当前的输入文件名打印出来：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># awk &#39;END&#123;print &quot;Current input file:&quot;, FILENAME&#125;&#39; student.txt </span><br><span class="line">Current input file: student.txt</span><br></pre></td></tr></table></figure>

<h3 id="FNR-变量"><a href="#FNR-变量" class="headerlink" title="FNR 变量"></a>FNR 变量</h3><p>FNR 变量表示相对于当前输入文件的记录数。  </p>
<p>与 NR 不同的是，这个值会是各个文件自己的行号，而 NR 对于多个文件，NR 的值是不断累加的。  </p>
<p>我们处理单个文件的情况较多，多文件处理相对用的少。  </p>
<h2 id="Expressions-as-Patterns"><a href="#Expressions-as-Patterns" class="headerlink" title="Expressions as Patterns"></a>Expressions as Patterns</h2><p>任何 awk 表达式都是合法的 awk 模式，如果表达式的值非零（对于整数）或者非空（对于字符串），则模式匹配。处理每条记录时，都会执行一次表达式。</p>
<h3 id="Comparison-expression"><a href="#Comparison-expression" class="headerlink" title="Comparison expression"></a>Comparison expression</h3><p>awk 支持比较表达式，比较运算符：==, !=, &gt;, &lt;, &gt;=, &lt;=。  </p>
<p>以下示例通过比较表达式提取本机所有监听端口：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># netstat -nap | awk &#39;$6 &#x3D;&#x3D; &quot;LISTEN&quot; &#123;print;&#125;&#39;</span><br><span class="line">tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN      1833&#x2F;smbd</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1652&#x2F;lighttpd</span><br><span class="line">tcp        0      0 0.0.0.0:83              0.0.0.0:*               LISTEN      1652&#x2F;lighttpd</span><br><span class="line">tcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      2858&#x2F;dnsmasq</span><br><span class="line">tcp        0      0 192.168.17.211:53       0.0.0.0:*               LISTEN      2858&#x2F;dnsmasq</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-match"><a href="#Pattern-match" class="headerlink" title="Pattern match"></a>Pattern match</h3><p>awk 跟 grep 一样，支持模式匹配。模式匹配格式：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">var ~ &#x2F;regex&#x2F; &lt;&#x3D;&gt; &#x2F;regex&#x2F;</span><br><span class="line">var !~ &#x2F;regex&#x2F; &lt;&#x3D;&gt; !&#x2F;regex&#x2F;</span><br><span class="line">&#96;&#96;&#96;  </span><br><span class="line"></span><br><span class="line">把上面的条件表达式改成模式匹配，其等价于：  </span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;  </span><br><span class="line"># netstat -nap | awk &#39;$6 ~ &#x2F;LISTEN&#x2F; &#123;print;&#125;&#39;</span><br><span class="line">tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN      1833&#x2F;smbd</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1652&#x2F;lighttpd</span><br><span class="line">tcp        0      0 0.0.0.0:83              0.0.0.0:*               LISTEN      1652&#x2F;lighttpd</span><br><span class="line">tcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      2858&#x2F;dnsmasq</span><br><span class="line">tcp        0      0 192.168.17.211:53       0.0.0.0:*               LISTEN      2858&#x2F;dnsmasq</span><br><span class="line"></span><br><span class="line">(or)</span><br><span class="line"></span><br><span class="line"># netstat -nap | awk &#39;&#x2F;LISTEN&#x2F; &#123;print;&#125;&#39;</span><br><span class="line">tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN      1833&#x2F;smbd</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1652&#x2F;lighttpd</span><br><span class="line">tcp        0      0 0.0.0.0:83              0.0.0.0:*               LISTEN      1652&#x2F;lighttpd</span><br><span class="line">tcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      2858&#x2F;dnsmasq</span><br><span class="line">tcp        0      0 192.168.17.211:53       0.0.0.0:*               LISTEN      2858&#x2F;dnsmasq</span><br></pre></td></tr></table></figure>

<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>opkg.info 文件记录了软件包信息，其中自动安装的软件包会包含 “Auto-Installed: yes” 字段。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># cat opkg.info </span><br><span class="line">Package: iwinfo</span><br><span class="line">Version: 2018-07-24-94b1366d-2</span><br><span class="line">Depends: libc, libiwinfo</span><br><span class="line">Status: install user installed</span><br><span class="line">Architecture: mips_24kc</span><br><span class="line">Installed-Time: 1553831708</span><br><span class="line"></span><br><span class="line">Package: luci-mod-rpc</span><br><span class="line">Version: git-18.196.56128-9112198-1</span><br><span class="line">Depends: libc, luci-lib-json</span><br><span class="line">Status: install user installed</span><br><span class="line">Architecture: all</span><br><span class="line">Installed-Time: 1553831708</span><br><span class="line"></span><br><span class="line">Package: ubus                 </span><br><span class="line">Version: 2018-01-16-5bae22eb-1</span><br><span class="line">Depends: libc, libubus, libblobmsg-json, ubusd</span><br><span class="line">Status: install ok installed</span><br><span class="line">Architecture: mips_24kc</span><br><span class="line">Installed-Time: 1553831711</span><br><span class="line">Auto-Installed: yes</span><br></pre></td></tr></table></figure>

<p>下面的示例使用了模式匹配的取反规则来打印所有非自动安装的软件包名称：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># awk &#39;BEGIN&#123;ORS&#x3D;&quot; &quot;;RS&#x3D;&quot;&quot;&#125;;!&#x2F;Auto-Installed&#x2F;&#123;print $2&#125;&#39; opkg.info </span><br><span class="line">iwinfo luci-mod-rpc</span><br></pre></td></tr></table></figure>

<h2 id="See-also"><a href="#See-also" class="headerlink" title="See also"></a>See also</h2><p><a href="https://www.gnu.org/software/gawk/manual/html_node/Expression-Patterns.html">https://www.gnu.org/software/gawk/manual/html_node/Expression-Patterns.html</a></p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="Kyson Lok"></figure><p class="title is-size-4 is-block line-height-inherit">Kyson Lok</p><p class="is-size-6 is-block">Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ShenZhen, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">10</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">12</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/kysonlok" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Gitee/"><span class="tag">Gitee</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Latex/"><span class="tag">Latex</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenWRT/"><span class="tag">OpenWRT</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Router/"><span class="tag">Router</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VPN/"><span class="tag">VPN</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VSCode/"><span class="tag">VSCode</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/awk/"><span class="tag">awk</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%BE%E5%BA%8A/"><span class="tag">图床</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"><span class="tag">密码学</span><span class="tag is-grey-lightest">2</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/VPN/"><span class="level-start"><span class="level-item">VPN</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%8A%9E%E5%85%AC%E5%88%A9%E5%99%A8/"><span class="level-start"><span class="level-item">办公利器</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%9E%83%E5%9C%BE%E6%A1%B6/"><span class="level-start"><span class="level-item">垃圾桶</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B8%8E%E5%AE%89%E5%85%A8/"><span class="level-start"><span class="level-item">密码学与安全</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">脚本语言</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Kyson&#039;s Blog</a><p class="size-small"><span>&copy; 2020 Kyson Lok</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://kysonlok.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><style>.searchbox .searchbox-body { background: white; }</style><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"><gcse:searchresults-only></gcse:searchresults-only></div></div><script>(function() {
            var cx = '015657951233762086388:7pwpztiskhw';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
        })();</script></div><script src="/js/google_cse.js"></script></body></html>